{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\marin\\\\Desktop\\\\bananaswap\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import{useCallback,useEffect,useState}from'react';import{useActiveWeb3React}from'../../hooks';import useDebounce from'../../hooks/useDebounce';import useIsWindowVisible from'../../hooks/useIsWindowVisible';import{updateBlockNumber}from'./actions';import{useDispatch}from'react-redux';export default function Updater(){var _useActiveWeb3React=useActiveWeb3React(),library=_useActiveWeb3React.library,chainId=_useActiveWeb3React.chainId;var dispatch=useDispatch();var windowVisible=useIsWindowVisible();var _useState=useState({chainId:chainId,blockNumber:null}),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];var blockNumberCallback=useCallback(function(blockNumber){setState(function(state){if(chainId===state.chainId){if(typeof state.blockNumber!=='number')return{chainId:chainId,blockNumber:blockNumber};return{chainId:chainId,blockNumber:Math.max(blockNumber,state.blockNumber)};}return state;});},[chainId,setState]);// attach/detach listeners\nuseEffect(function(){if(!library||!chainId||!windowVisible)return undefined;setState({chainId:chainId,blockNumber:null});library.getBlockNumber().then(blockNumberCallback).catch(function(error){return console.error(\"Failed to get block number for chainId: \".concat(chainId),error);});library.on('block',blockNumberCallback);return function(){library.removeListener('block',blockNumberCallback);};},[dispatch,chainId,library,blockNumberCallback,windowVisible]);var debouncedState=useDebounce(state,100);useEffect(function(){if(!debouncedState.chainId||!debouncedState.blockNumber||!windowVisible)return;dispatch(updateBlockNumber({chainId:debouncedState.chainId,blockNumber:debouncedState.blockNumber}));},[windowVisible,dispatch,debouncedState.blockNumber,debouncedState.chainId]);return null;}","map":{"version":3,"sources":["C:/Users/marin/Desktop/bananaswap/src/state/application/updater.ts"],"names":["useCallback","useEffect","useState","useActiveWeb3React","useDebounce","useIsWindowVisible","updateBlockNumber","useDispatch","Updater","library","chainId","dispatch","windowVisible","blockNumber","state","setState","blockNumberCallback","Math","max","undefined","getBlockNumber","then","catch","error","console","on","removeListener","debouncedState"],"mappings":"iKAAA,OAASA,WAAT,CAAsBC,SAAtB,CAAiCC,QAAjC,KAAiD,OAAjD,CACA,OAASC,kBAAT,KAAmC,aAAnC,CACA,MAAOC,CAAAA,WAAP,KAAwB,yBAAxB,CACA,MAAOC,CAAAA,kBAAP,KAA+B,gCAA/B,CACA,OAASC,iBAAT,KAAkC,WAAlC,CACA,OAASC,WAAT,KAA4B,aAA5B,CAEA,cAAe,SAASC,CAAAA,OAAT,EAAyB,CACtC,wBAA6BL,kBAAkB,EAA/C,CAAQM,OAAR,qBAAQA,OAAR,CAAiBC,OAAjB,qBAAiBA,OAAjB,CACA,GAAMC,CAAAA,QAAQ,CAAGJ,WAAW,EAA5B,CAEA,GAAMK,CAAAA,aAAa,CAAGP,kBAAkB,EAAxC,CAEA,cAA0BH,QAAQ,CAA8D,CAC9FQ,OAAO,CAAPA,OAD8F,CAE9FG,WAAW,CAAE,IAFiF,CAA9D,CAAlC,wCAAOC,KAAP,eAAcC,QAAd,eAKA,GAAMC,CAAAA,mBAAmB,CAAGhB,WAAW,CACrC,SAACa,WAAD,CAAyB,CACvBE,QAAQ,CAAC,SAAAD,KAAK,CAAI,CAChB,GAAIJ,OAAO,GAAKI,KAAK,CAACJ,OAAtB,CAA+B,CAC7B,GAAI,MAAOI,CAAAA,KAAK,CAACD,WAAb,GAA6B,QAAjC,CAA2C,MAAO,CAAEH,OAAO,CAAPA,OAAF,CAAWG,WAAW,CAAXA,WAAX,CAAP,CAC3C,MAAO,CAAEH,OAAO,CAAPA,OAAF,CAAWG,WAAW,CAAEI,IAAI,CAACC,GAAL,CAASL,WAAT,CAAsBC,KAAK,CAACD,WAA5B,CAAxB,CAAP,CACD,CACD,MAAOC,CAAAA,KAAP,CACD,CANO,CAAR,CAOD,CAToC,CAUrC,CAACJ,OAAD,CAAUK,QAAV,CAVqC,CAAvC,CAaA;AACAd,SAAS,CAAC,UAAM,CACd,GAAI,CAACQ,OAAD,EAAY,CAACC,OAAb,EAAwB,CAACE,aAA7B,CAA4C,MAAOO,CAAAA,SAAP,CAE5CJ,QAAQ,CAAC,CAAEL,OAAO,CAAPA,OAAF,CAAWG,WAAW,CAAE,IAAxB,CAAD,CAAR,CAEAJ,OAAO,CACJW,cADH,GAEGC,IAFH,CAEQL,mBAFR,EAGGM,KAHH,CAGS,SAAAC,KAAK,QAAIC,CAAAA,OAAO,CAACD,KAAR,mDAAyDb,OAAzD,EAAoEa,KAApE,CAAJ,EAHd,EAKAd,OAAO,CAACgB,EAAR,CAAW,OAAX,CAAoBT,mBAApB,EACA,MAAO,WAAM,CACXP,OAAO,CAACiB,cAAR,CAAuB,OAAvB,CAAgCV,mBAAhC,EACD,CAFD,CAGD,CAdQ,CAcN,CAACL,QAAD,CAAWD,OAAX,CAAoBD,OAApB,CAA6BO,mBAA7B,CAAkDJ,aAAlD,CAdM,CAAT,CAgBA,GAAMe,CAAAA,cAAc,CAAGvB,WAAW,CAACU,KAAD,CAAQ,GAAR,CAAlC,CAEAb,SAAS,CAAC,UAAM,CACd,GAAI,CAAC0B,cAAc,CAACjB,OAAhB,EAA2B,CAACiB,cAAc,CAACd,WAA3C,EAA0D,CAACD,aAA/D,CAA8E,OAC9ED,QAAQ,CAACL,iBAAiB,CAAC,CAAEI,OAAO,CAAEiB,cAAc,CAACjB,OAA1B,CAAmCG,WAAW,CAAEc,cAAc,CAACd,WAA/D,CAAD,CAAlB,CAAR,CACD,CAHQ,CAGN,CAACD,aAAD,CAAgBD,QAAhB,CAA0BgB,cAAc,CAACd,WAAzC,CAAsDc,cAAc,CAACjB,OAArE,CAHM,CAAT,CAKA,MAAO,KAAP,CACD","sourcesContent":["import { useCallback, useEffect, useState } from 'react'\r\nimport { useActiveWeb3React } from '../../hooks'\r\nimport useDebounce from '../../hooks/useDebounce'\r\nimport useIsWindowVisible from '../../hooks/useIsWindowVisible'\r\nimport { updateBlockNumber } from './actions'\r\nimport { useDispatch } from 'react-redux'\r\n\r\nexport default function Updater(): null {\r\n  const { library, chainId } = useActiveWeb3React()\r\n  const dispatch = useDispatch()\r\n\r\n  const windowVisible = useIsWindowVisible()\r\n\r\n  const [state, setState] = useState<{ chainId: number | undefined; blockNumber: number | null }>({\r\n    chainId,\r\n    blockNumber: null\r\n  })\r\n\r\n  const blockNumberCallback = useCallback(\r\n    (blockNumber: number) => {\r\n      setState(state => {\r\n        if (chainId === state.chainId) {\r\n          if (typeof state.blockNumber !== 'number') return { chainId, blockNumber }\r\n          return { chainId, blockNumber: Math.max(blockNumber, state.blockNumber) }\r\n        }\r\n        return state\r\n      })\r\n    },\r\n    [chainId, setState]\r\n  )\r\n\r\n  // attach/detach listeners\r\n  useEffect(() => {\r\n    if (!library || !chainId || !windowVisible) return undefined\r\n\r\n    setState({ chainId, blockNumber: null })\r\n\r\n    library\r\n      .getBlockNumber()\r\n      .then(blockNumberCallback)\r\n      .catch(error => console.error(`Failed to get block number for chainId: ${chainId}`, error))\r\n\r\n    library.on('block', blockNumberCallback)\r\n    return () => {\r\n      library.removeListener('block', blockNumberCallback)\r\n    }\r\n  }, [dispatch, chainId, library, blockNumberCallback, windowVisible])\r\n\r\n  const debouncedState = useDebounce(state, 100)\r\n\r\n  useEffect(() => {\r\n    if (!debouncedState.chainId || !debouncedState.blockNumber || !windowVisible) return\r\n    dispatch(updateBlockNumber({ chainId: debouncedState.chainId, blockNumber: debouncedState.blockNumber }))\r\n  }, [windowVisible, dispatch, debouncedState.blockNumber, debouncedState.chainId])\r\n\r\n  return null\r\n}\r\n"]},"metadata":{},"sourceType":"module"}